(()=>{"use strict";var e={},t={};function r(i){var n=t[i];if(void 0!==n)return n.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,r),o.exports}function i(e,t){if(void 0===e)throw TypeError("attempted to "+t+" private static field before its declaration")}function n(e,t,r){return a(e,t),i(r,"get"),r.get?r.get.call(e):r.value}r.rv=()=>"1.2.7",r.ruid="bundler=rspack@1.2.7";function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){if(e!==t)throw TypeError("Private static access of wrong provenance")}var s=function(){var e;function t(e,r){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,t),o(this,"vertices",void 0),o(this,"indices",void 0),o(this,"vertixCount",void 0),o(this,"triangleCount",void 0),this.vertices=e,this.indices=r,this.vertixCount=e.length/8,this.triangleCount=r.length/3}return e=[{key:"sphere",get:function(){if(null===n(this,t,u)){var e;e=t.createSphere(),a(this,t),i(u,"set"),function(e,t,r){if(t.set)t.set.call(e,r);else{if(!t.writable)throw TypeError("attempted to set read only private field");t.value=r}}(this,u,e)}return n(this,t,u)}},{key:"createSphere",value:function(){for(var e=Math.sin(Math.PI/4),r=Array(10),i=Math.PI/44,n=i,o=0;o<10;o++,n+=i)r[o]={cos:Math.cos(n),sin:Math.sin(n)};for(var a=Array(43),s=0;s<43;s++)a[s]=Array(89);a[21][0]={x:1,y:0,z:0},a[21][11]={x:e,y:0,z:e},a[21][22]={x:0,y:0,z:1},a[21][33]={x:-e,y:0,z:e},a[21][44]={x:-1,y:0,z:0},a[21][55]={x:-e,y:0,z:-e},a[21][66]={x:0,y:0,z:-1},a[21][77]={x:e,y:0,z:-e},a[21][88]={x:1,y:0,z:0};for(var u=1;u<=10;u++){var c=r[u-1].cos,l=r[u-1].sin;a[21][u]={x:c,y:0,z:l},a[21][22-u]={x:l,y:0,z:c},a[21][22+u]={x:-l,y:0,z:c},a[21][44-u]={x:-c,y:0,z:l},a[21][44+u]={x:-c,y:0,z:-l},a[21][66-u]={x:-l,y:0,z:-c},a[21][66+u]={x:l,y:0,z:-c},a[21][88-u]={x:c,y:0,z:-l}}for(var h=10,f=32,v=0;v<89;v++){var d=a[21][v].x*e,m=a[21][v].z*e;a[h][v]={x:d,y:e,z:m},a[f][v]={x:d,y:-e,z:m}}for(var p=1;p<=10;p++)for(var g=r[p-1].cos,b=r[p-1].sin,y=0;y<89;y++){var x=a[21][y].x*b,w=a[21][y].z*b,P=a[21][y].x*g,C=a[21][y].z*g;a[p-1][y]={x:x,y:g,z:w},a[21-p][y]={x:P,y:b,z:C},a[21+p][y]={x:P,y:-b,z:C},a[43-p][y]={x:x,y:-g,z:w}}for(var S=Array(8*a.length),B=0,T=.011363636363636364,E=.022727272727272728,A=T/2,k=0;k<88;k++)S[B++]=0,S[B++]=1,S[B++]=0,S[B++]=0,S[B++]=1,S[B++]=0,S[B++]=A,S[B++]=1,A+=T;for(var M=1-E,R=0;R<43;R++){for(var U=0,z=0;z<89;z++)S[B++]=a[R][z].x,S[B++]=a[R][z].y,S[B++]=a[R][z].z,S[B++]=a[R][z].x,S[B++]=a[R][z].y,S[B++]=a[R][z].z,S[B++]=U,S[B++]=M,U+=T;M-=E}for(var I=T/2,D=0;D<88;D++)S[B++]=0,S[B++]=-1,S[B++]=0,S[B++]=0,S[B++]=-1,S[B++]=0,S[B++]=I,S[B++]=0,I+=T;for(var F=88,O=Array(3*(2*F+7392)),L=0,_=0;_<F;_++)O[L++]=_,O[L++]=F+_,O[L++]=F+_+1;for(var N=0;N<42;N++)for(var G=0;G<88;G++){var V=F+89*N+G,j=F+89*N+G+1,q=F+89*(N+1)+G,X=F+89*(N+1)+G+1;O[L++]=j,O[L++]=V,O[L++]=X,O[L++]=X,O[L++]=V,O[L++]=q}for(var H=3827,Y=F+H,K=F+H-89,W=0;W<F;W++)O[L++]=K+W,O[L++]=Y+W,O[L++]=K+W+1;return new t(new Float32Array(S),new Uint16Array(O))}}],function(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t,e),t}();o(s,"cube",new s(new Float32Array([1,1,1,0,0,1,1,1,1,-1,1,0,0,1,1,0,-1,-1,1,0,0,1,0,0,-1,1,1,0,0,1,0,1,1,1,-1,0,1,0,1,1,1,1,1,0,1,0,1,0,-1,1,1,0,1,0,0,0,-1,1,-1,0,1,0,0,1,1,-1,1,0,-1,0,1,1,1,-1,-1,0,-1,0,1,0,-1,-1,-1,0,-1,0,0,0,-1,-1,1,0,-1,0,0,1,-1,1,1,-1,0,0,1,1,-1,-1,1,-1,0,0,1,0,-1,-1,-1,-1,0,0,0,0,-1,1,-1,-1,0,0,0,1,1,1,-1,1,0,0,1,1,1,-1,-1,1,0,0,1,0,1,-1,1,1,0,0,0,0,1,1,1,1,0,0,0,1,-1,1,-1,0,0,-1,1,1,-1,-1,-1,0,0,-1,1,0,1,-1,-1,0,0,-1,0,0,1,1,-1,0,0,-1,0,1]),new Uint16Array([0,1,3,1,2,3,4,5,7,5,6,7,8,9,11,9,10,11,12,13,15,13,14,15,16,17,19,17,18,19,20,21,23,21,22,23])));var u={writable:!0,value:null};function c(e,t,r,i,n,o,a){try{var s=e[o](a),u=s.value}catch(e){r(e);return}s.done?t(u):Promise.resolve(u).then(i,n)}function l(e){return function(){var t=this,r=arguments;return new Promise(function(i,n){var o=e.apply(t,r);function a(e){c(o,i,n,a,s,"next",e)}function s(e){c(o,i,n,a,s,"throw",e)}a(void 0)})}}function h(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function f(e,t){var r,i,n,o,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw TypeError("Generator is already executing.");for(;a;)try{if(r=1,i&&(n=2&o[0]?i.return:o[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,o[1])).done)return n;switch(i=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(n=(n=a.trys).length>0&&n[n.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){a.label=o[1];break}if(6===o[0]&&a.label<n[1]){a.label=n[1],n=o;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(o);break}n[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var v=function(){var e;function t(){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,t),h(this,"canvas",document.createElement("canvas")),h(this,"context",this.canvas.getContext("2d")),h(this,"image",new Image)}return e=[{key:"loadPng",value:function(e){var t=this;return l(function(){return f(this,function(r){switch(r.label){case 0:return[4,t.fetchImage(e)];case 1:return[4,createImageBitmap(r.sent())];case 2:return[2,r.sent()]}})})()}},{key:"loadSvg",value:function(e,t,r){var i=this;return l(function(){var n;return f(this,function(o){switch(o.label){case 0:return[4,i.fetchImage(e)];case 1:return n=o.sent(),[4,new Promise(function(e,o){i.image.onload=function(){i.canvas.width=t,i.canvas.height=r,i.context.drawImage(i.image,0,0,i.canvas.width,i.canvas.height),URL.revokeObjectURL(i.image.src),i.canvas.toBlob(function(t){return null!==t?e(t):o("'canvas.toBlob' failed: it returned null")})},i.image.src=URL.createObjectURL(n)})];case 2:return[4,createImageBitmap(o.sent())];case 3:return[2,o.sent()]}})})()}},{key:"fetchImage",value:function(e){return l(function(){var t;return f(this,function(r){switch(r.label){case 0:return[4,fetch(e)];case 1:if(!(t=r.sent()).ok)throw Error("fetch error '".concat(e,"': ").concat(t.status));return[4,t.blob()];case 2:return[2,r.sent()]}})})()}}],function(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t.prototype,e),t}(),d="undefined"!=typeof Float32Array?Float32Array:Array;function m(){var e=new d(16);return d!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function p(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function g(e,t,r){var i,n,o,a,s,u,c,l,h,f,v,d,m=r[0],p=r[1],g=r[2];return t===e?(e[12]=t[0]*m+t[4]*p+t[8]*g+t[12],e[13]=t[1]*m+t[5]*p+t[9]*g+t[13],e[14]=t[2]*m+t[6]*p+t[10]*g+t[14],e[15]=t[3]*m+t[7]*p+t[11]*g+t[15]):(i=t[0],n=t[1],o=t[2],a=t[3],s=t[4],u=t[5],c=t[6],l=t[7],h=t[8],f=t[9],v=t[10],d=t[11],e[0]=i,e[1]=n,e[2]=o,e[3]=a,e[4]=s,e[5]=u,e[6]=c,e[7]=l,e[8]=h,e[9]=f,e[10]=v,e[11]=d,e[12]=i*m+s*p+h*g+t[12],e[13]=n*m+u*p+f*g+t[13],e[14]=o*m+c*p+v*g+t[14],e[15]=a*m+l*p+d*g+t[15]),e}function b(e,t,r){var i=r[0],n=r[1],o=r[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var y=function(e,t,r,i,n){var o,a=1/Math.tan(t/2);return e[0]=a/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=n&&n!==1/0?(o=1/(i-n),e[10]=(n+i)*o,e[14]=2*n*i*o):(e[10]=-1,e[14]=-2*i),e};function x(e,t,r,i,n,o,a){try{var s=e[o](a),u=s.value}catch(e){r(e);return}s.done?t(u):Promise.resolve(u).then(i,n)}function w(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function P(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var C=function(){var e,t;function r(e,t,i,n,o){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,r),P(this,"htmlCanvas",void 0),P(this,"canvasContext",void 0),P(this,"gpuAdapter",void 0),P(this,"device",void 0),P(this,"gpuBindGroup",void 0),P(this,"objectRenderPipeline",void 0),P(this,"backgroundRenderPipeline",void 0),P(this,"renderPassDescriptor",void 0),P(this,"cubeVertexBuffer",void 0),P(this,"cubeIndexBuffer",void 0),P(this,"sphereVertexBuffer",void 0),P(this,"sphereIndexBuffer",void 0),P(this,"texture",void 0),P(this,"textureSampler",void 0),P(this,"modelMatrices",void 0),P(this,"transformationUniform",void 0),P(this,"brightnessUniform",void 0),P(this,"colorRotateUnifrom",void 0),P(this,"lightDirectionUniform",void 0),P(this,"commandEncoder",void 0),P(this,"renderPassEncoder",void 0),this.htmlCanvas=e,this.gpuAdapter=t,this.device=i,this.canvasContext=this.htmlCanvas.getContext("webgpu"),this.canvasContext.configure({device:this.device,format:r.COLOR_FORMAT,usage:GPUTextureUsage.RENDER_ATTACHMENT}),this.renderPassDescriptor={colorAttachments:[{view:this.createMultisampleTexture(),resolveTarget:null,loadOp:"clear",clearValue:[.3,.3,.3,1],storeOp:"store"}],depthStencilAttachment:{view:this.createDepthStencilView(),depthLoadOp:"clear",depthClearValue:1,depthStoreOp:"store",stencilLoadOp:"clear",stencilClearValue:0,stencilStoreOp:"store"}},this.cubeVertexBuffer=this.device.createBuffer({size:s.cube.vertices.byteLength,usage:GPUBufferUsage.VERTEX,mappedAtCreation:!0}),new Float32Array(this.cubeVertexBuffer.getMappedRange()).set(s.cube.vertices),this.cubeVertexBuffer.unmap(),this.cubeIndexBuffer=this.device.createBuffer({size:s.cube.indices.byteLength,usage:GPUBufferUsage.INDEX,mappedAtCreation:!0}),new Uint16Array(this.cubeIndexBuffer.getMappedRange()).set(s.cube.indices),this.cubeIndexBuffer.unmap(),this.sphereVertexBuffer=this.device.createBuffer({size:s.sphere.vertices.byteLength,usage:GPUBufferUsage.VERTEX,mappedAtCreation:!0}),new Float32Array(this.sphereVertexBuffer.getMappedRange()).set(s.sphere.vertices),this.sphereVertexBuffer.unmap(),this.sphereIndexBuffer=this.device.createBuffer({size:s.sphere.indices.byteLength,usage:GPUBufferUsage.INDEX,mappedAtCreation:!0}),new Uint16Array(this.sphereIndexBuffer.getMappedRange()).set(s.sphere.indices),this.sphereIndexBuffer.unmap();var a={size:{width:o.width,height:o.height},format:r.COLOR_FORMAT,usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT};this.texture=this.device.createTexture(a),this.device.queue.copyExternalImageToTexture({source:o},{texture:this.texture},a.size),this.textureSampler=this.device.createSampler({addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"nearest",maxAnisotropy:1});var u=new Float32Array((1+s.sphere.vertixCount)*16),c=m();g(c,c,[0,0,-500]),b(c,c,[20,20,20]),u.set(c,0);for(var l=0;l<s.sphere.vertixCount;l++)p(c),g(c,c,[200*s.sphere.vertices[8*l],200*s.sphere.vertices[8*l+1],200*s.sphere.vertices[8*l+2]-500]),b(c,c,[.5,.5,.5]),u.set(c,(l+1)*16);this.modelMatrices=this.device.createBuffer({size:(1+s.sphere.vertixCount+r.OBJECT_BUFFER_SIZE)*64,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST,mappedAtCreation:!0}),new Float32Array(this.modelMatrices.getMappedRange()).set(u),this.modelMatrices.unmap(),this.transformationUniform=i.createBuffer({size:128,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.brightnessUniform=i.createBuffer({size:4,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.colorRotateUnifrom=i.createBuffer({size:4,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.lightDirectionUniform=i.createBuffer({size:12,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});var h=this.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,texture:{}},{binding:1,visibility:GPUShaderStage.FRAGMENT,sampler:{}},{binding:2,visibility:GPUShaderStage.VERTEX,buffer:{type:"read-only-storage",hasDynamicOffset:!1}},{binding:3,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,buffer:{}},{binding:4,visibility:GPUShaderStage.FRAGMENT,buffer:{}},{binding:5,visibility:GPUShaderStage.FRAGMENT,buffer:{}},{binding:6,visibility:GPUShaderStage.FRAGMENT,buffer:{}}]});this.gpuBindGroup=this.device.createBindGroup({layout:h,entries:[{binding:0,resource:this.texture.createView({format:r.COLOR_FORMAT,dimension:"2d",aspect:"all",baseMipLevel:0,mipLevelCount:1,baseArrayLayer:0,arrayLayerCount:1})},{binding:1,resource:this.textureSampler},{binding:2,resource:{buffer:this.modelMatrices}},{binding:3,resource:{buffer:this.transformationUniform}},{binding:4,resource:{buffer:this.brightnessUniform}},{binding:5,resource:{buffer:this.colorRotateUnifrom}},{binding:6,resource:{buffer:this.lightDirectionUniform}}]});var f={arrayStride:32,attributes:[{format:"float32x3",shaderLocation:0,offset:0},{format:"float32x3",shaderLocation:1,offset:12},{format:"float32x2",shaderLocation:2,offset:24}]};this.objectRenderPipeline=this.device.createRenderPipeline({layout:this.device.createPipelineLayout({bindGroupLayouts:[h]}),vertex:{module:n,entryPoint:"vertex_main",buffers:[f]},fragment:{module:n,entryPoint:"fragment_main",targets:[{format:r.COLOR_FORMAT}]},depthStencil:{format:r.DEPTH_FORMAT,depthWriteEnabled:!0,depthCompare:"less"},primitive:{topology:"triangle-list",cullMode:"back",frontFace:"cw"},multisample:{count:r.SAMPLE_COUNT}}),this.backgroundRenderPipeline=this.device.createRenderPipeline({layout:this.device.createPipelineLayout({bindGroupLayouts:[h]}),vertex:{module:n,entryPoint:"background_vertex_main",buffers:[f]},fragment:{module:n,entryPoint:"background_fragment_main",targets:[{format:r.COLOR_FORMAT}]},depthStencil:{format:r.DEPTH_FORMAT,depthWriteEnabled:!0,depthCompare:"less-equal"},primitive:{topology:"triangle-list",cullMode:"back",frontFace:"ccw"},multisample:{count:r.SAMPLE_COUNT}})}return e=[{key:"renderStart",value:function(){this.renderPassDescriptor.colorAttachments[0].resolveTarget=this.canvasContext.getCurrentTexture().createView(),this.commandEncoder=this.device.createCommandEncoder(),this.renderPassEncoder=this.commandEncoder.beginRenderPass(this.renderPassDescriptor),this.renderPassEncoder.setBindGroup(0,this.gpuBindGroup)}},{key:"setObjectShader",value:function(){this.renderPassEncoder.setPipeline(this.objectRenderPipeline)}},{key:"renderLittleSphere",value:function(){this.renderPassEncoder.setVertexBuffer(0,this.sphereVertexBuffer),this.renderPassEncoder.setIndexBuffer(this.sphereIndexBuffer,"uint16"),this.renderPassEncoder.drawIndexed(s.sphere.indices.length,1)}},{key:"renderSphereCubes",value:function(){this.renderPassEncoder.setVertexBuffer(0,this.cubeVertexBuffer),this.renderPassEncoder.setIndexBuffer(this.cubeIndexBuffer,"uint16"),this.renderPassEncoder.drawIndexed(s.cube.indices.length,s.sphere.vertixCount,0,0,1)}},{key:"renderDigits",value:function(e){this.device.queue.writeBuffer(this.modelMatrices,(1+s.sphere.vertixCount)*64,e),this.renderPassEncoder.setVertexBuffer(0,this.cubeVertexBuffer),this.renderPassEncoder.setIndexBuffer(this.cubeIndexBuffer,"uint16"),this.renderPassEncoder.drawIndexed(s.cube.indices.length,e.byteLength/64,0,0,1+s.sphere.vertixCount)}},{key:"setBackgroundShader",value:function(){this.renderPassEncoder.setPipeline(this.backgroundRenderPipeline)}},{key:"renderBeckgound",value:function(){this.renderPassEncoder.setVertexBuffer(0,this.sphereVertexBuffer),this.renderPassEncoder.setIndexBuffer(this.sphereIndexBuffer,"uint16"),this.renderPassEncoder.drawIndexed(s.sphere.indices.length,1)}},{key:"renderEnd",value:function(){this.renderPassEncoder.end(),this.device.queue.submit([this.commandEncoder.finish()])}},{key:"view",set:function(e){this.device.queue.writeBuffer(this.transformationUniform,0,e)}},{key:"projection",set:function(e){this.device.queue.writeBuffer(this.transformationUniform,64,e)}},{key:"brightness",set:function(e){this.device.queue.writeBuffer(this.brightnessUniform,0,new Float32Array([e]))}},{key:"colorRotate",set:function(e){this.device.queue.writeBuffer(this.colorRotateUnifrom,0,new Float32Array([e]))}},{key:"lightDirection",set:function(e){this.device.queue.writeBuffer(this.lightDirectionUniform,0,e)}},{key:"renewRenderTextures",value:function(){this.renderPassDescriptor.depthStencilAttachment.view=this.createDepthStencilView(),this.renderPassDescriptor.colorAttachments[0].view=this.createMultisampleTexture()}},{key:"createDepthStencilView",value:function(){return this.device.createTexture({size:{width:this.htmlCanvas.width,height:this.htmlCanvas.height,depthOrArrayLayers:1},format:r.DEPTH_FORMAT,usage:GPUTextureUsage.RENDER_ATTACHMENT,sampleCount:r.SAMPLE_COUNT}).createView()}},{key:"createMultisampleTexture",value:function(){return this.device.createTexture({size:{width:this.htmlCanvas.width,height:this.htmlCanvas.height,depthOrArrayLayers:1},format:r.COLOR_FORMAT,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.SAMPLED,sampleCount:r.SAMPLE_COUNT}).createView()}}],t=[{key:"create",value:function(e){var t;return(t=function(){var t,i,n,o,a,s,u,c,l,h,f;return function(e,t){var r,i,n,o,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw TypeError("Generator is already executing.");for(;a;)try{if(r=1,i&&(n=2&o[0]?i.return:o[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,o[1])).done)return n;switch(i=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(n=(n=a.trys).length>0&&n[n.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){a.label=o[1];break}if(6===o[0]&&a.label<n[1]){a.label=n[1],n=o;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(o);break}n[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}(this,function(d){switch(d.label){case 0:if(void 0===navigator.gpu)throw Error("WebGPU is not supported/enabled in your browser");return[4,navigator.gpu.requestAdapter()];case 1:return[4,(t=d.sent()).requestDevice()];case 2:return[4,(n=(i=d.sent()).createShaderModule({code:"struct Vertex {\n    @location(0) position: vec3<f32>,\n    @location(1) normal: vec3<f32>,\n    @location(2) texturePosition: vec2<f32>\n}\n\nstruct Fragment {\n    @builtin(position) position: vec4<f32>,\n    @location(0) localPosition: vec3<f32>,\n    @location(1) normal: vec3<f32>,\n    @location(2) texturePosition: vec2<f32>\n}\n\nstruct BackgroundFragment {\n    @builtin(position) position: vec4<f32>,\n    @location(0) yPosition: f32,\n    @location(1) normal: vec3<f32>,\n    @location(2) texturePosition: vec2<f32>\n}\n\n\nstruct Tranformation {\n    view: mat4x4<f32>,\n    projection: mat4x4<f32>\n}\n\n\n@group(0) @binding(0) var theTexture: texture_2d<f32>;\n@group(0) @binding(1) var theSampler: sampler;\n\n@group(0) @binding(2) var<storage, read> modelBuffer: array<mat4x4<f32>>;\n\n@group(0) @binding(3) var<uniform> tranformation: Tranformation;\n@group(0) @binding(4) var<uniform> brightness: f32;\n@group(0) @binding(5) var<uniform> colorRotate: f32;\n@group(0) @binding(6) var<uniform> lightDirection: vec3<f32>;\n\n\n@vertex\nfn vertex_main(@builtin(instance_index) index: u32, vertex: Vertex) -> Fragment {\n    var result: Fragment;\n    \n    result.localPosition = vertex.position;\n    result.normal = vertex.normal;\n    result.texturePosition = vertex.texturePosition;\n    result.position = tranformation.projection * tranformation.view * modelBuffer[index] * vec4(vertex.position, 1.0);\n    \n    return result;\n}\n\n@fragment\nfn fragment_main(fragment: Fragment) -> @location(0) vec4<f32> {\n    // hsv color\n\n    const MIN: f32 = 1.0;\n    const MAX: f32 = 3.0;\n    const SPAN: f32 = MAX - MIN;\n    let squareDistance: f32 = fragment.localPosition.x * fragment.localPosition.x + fragment.localPosition.y * fragment.localPosition.y + fragment.localPosition.z * fragment.localPosition.z;\n\n    var h: f32 = ((squareDistance - MIN) / SPAN + colorRotate);\n    if (h > 1.0) { h -= 1.0; }\n    let s: f32 = 1.0;\n    let v: f32 = brightness;\n\n    let hsvColor: vec3<f32> = hsv2rgb(vec3<f32>(h, s, v));\n\n\n\n    // texture\n\n    const TEXTURE_OPACITY: f32 = 0.5;\n    let textureColor: vec4<f32> = textureSample(theTexture, theSampler, fragment.texturePosition);\n    let opacity: f32 = TEXTURE_OPACITY * textureColor.a;\n\n\n\n    // Phong\n\n    const AMBIENT: f32 = 0.5;\n    const DIFFUSE: f32 = 2.0;\n    const SPECULAR: f32 = 4.0;\n    const SPECULAR_SHININESS: f32 = 64.0;\n\n    let ambient: f32 = AMBIENT;\n\n    let diffuseAngle: f32 = max(dot(fragment.normal, lightDirection), 0.0);\n    let diffuse: f32 = diffuseAngle * DIFFUSE;\n\n    let viewDirection: vec3<f32> = mat3x3<f32>(tranformation.view[0].xyz, tranformation.view[1].xyz, tranformation.view[2].xyz) * vec3(0.0, 0.0, 1.0);\n    let reflectDirection: vec3<f32> = reflect(-lightDirection, fragment.normal);\n    let specularAngle: f32 = max(dot(viewDirection, reflectDirection), 0.0);\n    let specular: f32 = pow(specularAngle, SPECULAR_SHININESS) * SPECULAR;\n\n    let strength: f32 = ambient + diffuse + specular;\n\n\n\n    let hsvPart: vec3<f32> = (1 - opacity) * hsvColor;\n    let texturePart: vec3<f32> = opacity * textureColor.rgb;\n    let color: vec3<f32> = (hsvPart + texturePart) * strength;\n    return vec4(color, 1.0);\n}\n\nfn hsv2rgb(c: vec3<f32>) -> vec3<f32> {\n    let k: vec4<f32> = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n    let p: vec3<f32> = abs(fract(c.xxx + k.xyz) * 6.0 - k.www);\n    return c.z * mix(k.xxx, clamp(p - k.xxx, vec3<f32>(0.0), vec3<f32>(1.0)), c.y);\n}\n\n\n@vertex\nfn background_vertex_main(vertex: Vertex) -> BackgroundFragment {\n    var result: BackgroundFragment;\n\n    result.yPosition = vertex.position.y;\n    result.normal = vertex.normal;\n    result.texturePosition = vertex.texturePosition;\n    \n    let viewRotation = mat3x3<f32>(tranformation.view[0].xyz, tranformation.view[1].xyz, tranformation.view[2].xyz);\n    let positionWithDepth = tranformation.projection * vec4(viewRotation * vertex.position, 1.0);\n    result.position = positionWithDepth.xyww;\n\n    return result;\n}\n\n@fragment\nfn background_fragment_main(fragment: BackgroundFragment) -> @location(0) vec4<f32> {\n    let textureColor: vec4<f32> = textureSample(theTexture, theSampler, fragment.texturePosition);\n    \n    let brightness: f32 = (fragment.yPosition + 6.0) / 8.0;\n    let backgroundColor: vec3<f32> = vec3(brightness, brightness, 0.9);\n\n    let filledColor: vec3<f32> = mix(backgroundColor, textureColor.rgb, textureColor.a);\n    let tintedColor = mix(filledColor, backgroundColor, 0.8);\n\n    \n    // Phong\n\n    const AMBIENT: f32 = 1.0;\n    const DIFFUSE: f32 = 0.6;\n    const SPECULAR: f32 = 1.0;\n    const SPECULAR_SHININESS: f32 = 32.0;\n\n    let ambient: f32 = AMBIENT;\n\n    let diffuseAngle: f32 = max(dot(fragment.normal, lightDirection), 0.0);\n    let diffuse: f32 = diffuseAngle * DIFFUSE;\n\n    let viewDirection: vec3<f32> = mat3x3<f32>(tranformation.view[0].xyz, tranformation.view[1].xyz, tranformation.view[2].xyz) * vec3(0.0, 0.0, 1.0);\n    let reflectDirection: vec3<f32> = reflect(-lightDirection, fragment.normal);\n    let specularAngle: f32 = max(dot(viewDirection, reflectDirection), 0.0);\n    let specular: f32 = pow(specularAngle, SPECULAR_SHININESS) * SPECULAR;\n\n    let strength: f32 = ambient + diffuse + specular;\n\n    \n    let resultColor: vec3<f32> = tintedColor * strength;\n    return vec4(resultColor, 1.0);\n}\n"})).getCompilationInfo()];case 3:o=d.sent(),a=!0,s=!1,u=void 0;try{for(c=o.messages[Symbol.iterator]();!(a=(l=c.next()).done);a=!0)if(h=l.value,"error"===h.type)throw Error("aborted => shader module compilation error(s)")}catch(e){s=!0,u=e}finally{try{a||null==c.return||c.return()}finally{if(s)throw u}}return[4,new v().loadSvg("img/rose.svg",4096,4096)];case 4:return f=d.sent(),[2,new r(e,t,i,n,f)]}})},function(){var e=this,r=arguments;return new Promise(function(i,n){var o=t.apply(e,r);function a(e){x(o,i,n,a,s,"next",e)}function s(e){x(o,i,n,a,s,"throw",e)}a(void 0)})})()}}],e&&w(r.prototype,e),t&&w(r,t),r}();function S(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function B(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}P(C,"COLOR_FORMAT","bgra8unorm"),P(C,"DEPTH_FORMAT","depth24plus-stencil8"),P(C,"SAMPLE_COUNT",4),P(C,"OBJECT_BUFFER_SIZE",512);var T=function(){var e,t;function r(e,t,i,n,o,a){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,r),B(this,"ax",void 0),B(this,"bx",void 0),B(this,"ay",void 0),B(this,"by",void 0),B(this,"az",void 0),B(this,"bz",void 0),B(this,"isAx",void 0),B(this,"isBx",void 0),B(this,"isAy",void 0),B(this,"isBy",void 0),B(this,"isAz",void 0),B(this,"isBz",void 0),this.ax=e,this.bx=t,this.ay=i,this.by=n,this.az=o,this.bz=a}return e=[{key:"hasCollision",value:function(e){this.isAx=this.ax<e.ax&&e.ax<this.bx,this.isBx=this.ax<e.bx&&e.bx<this.bx;var t=e.ax<=this.ax&&this.bx<=e.bx;if(!this.isAx&&!this.isBx&&!t)return!1;this.isAy=this.ay<e.ay&&e.ay<this.by,this.isBy=this.ay<e.by&&e.by<this.by;var r=e.ay<=this.ay&&this.by<=e.by;if(!this.isAy&&!this.isBy&&!r)return!1;this.isAz=this.az<e.az&&e.az<this.bz,this.isBz=this.az<e.bz&&e.bz<this.bz;var i=e.az<=this.az&&this.bz<=e.bz;return!!this.isAz||!!this.isBz||!!i}},{key:"handleCollision",value:function(e){function t(e,t,r,i,n,o){if(e&&!t)return i-n;if(!e&&t)return r-o;var a=o-r,s=i-n;return a<s?-a:s}var r=t(this.isAx,this.isBx,this.ax,this.bx,e.ax,e.bx),i=t(this.isAy,this.isBy,this.ay,this.by,e.ay,e.by),n=t(this.isAz,this.isBz,this.az,this.bz,e.az,e.bz);if(Math.abs(r)<Math.abs(i))return Math.abs(r)<Math.abs(n)?[r,0,0]:[0,0,n];return Math.abs(i)<Math.abs(n)?[0,i,0]:[0,0,n]}}],t=[{key:"create",value:function(e,t){return new r(e[0]-t,e[0]+t,e[1]-t,e[1]+t,e[2]-t,e[2]+t)}}],e&&S(r.prototype,e),t&&S(r,t),r}();function E(){var e=new d(3);return d!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}E();function A(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var k=function(){var e;function t(e,r,i){var n=this;!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,t),A(this,"renderer",void 0),A(this,"htmlCanvas",void 0),A(this,"dialogButton",void 0),A(this,"modelBuffer",new Float32Array(16*C.OBJECT_BUFFER_SIZE)),A(this,"boxColliderBuffer",Array(512)),A(this,"boxColliderCount",0),A(this,"viewPos",void 0),A(this,"viewRotation",void 0),A(this,"view",void 0),A(this,"projectionFieldOfView",1),A(this,"projection",void 0),A(this,"brightnessTimer",0),A(this,"colorTimer",0),A(this,"lightDirectionTimer",0),A(this,"timeout",void 0),A(this,"moveSpeed",void 0),A(this,"mouseSensitivity",1),A(this,"gameLoop",function(){n.windowResized&&(n.renderer.renewRenderTextures(),n.windowResized=!1);var e,r,i,o,a,s,u,c,l,h,f,v,m,b,y,x,w,P,C,S,B,T,E,A,k,M,R,U=n.createDigitModels(),z=n.moveFast?.1*t.SPEED_MULTIPLIER*n.moveSpeed:.1*n.moveSpeed,I=-Math.sin(n.viewRotation[0])*z,D=Math.cos(n.viewRotation[0])*z;n.moveForward&&(n.viewPos[0]+=I,n.viewPos[2]+=D),n.moveBackward&&(n.viewPos[0]-=I,n.viewPos[2]-=D),n.moveLeft&&(n.viewPos[0]+=D,n.viewPos[2]-=I),n.moveRight&&(n.viewPos[0]-=D,n.viewPos[2]+=I),n.moveUp&&(n.viewPos[1]-=z),n.moveDown&&(n.viewPos[1]+=z),n.handleCameraCollision(),p(n.view),e=n.view,r=n.view,o=Math.sin(i=n.viewRotation[1]),a=Math.cos(i),s=r[4],u=r[5],c=r[6],l=r[7],h=r[8],f=r[9],v=r[10],m=r[11],r!==e&&(e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[4]=s*a+h*o,e[5]=u*a+f*o,e[6]=c*a+v*o,e[7]=l*a+m*o,e[8]=h*a-s*o,e[9]=f*a-u*o,e[10]=v*a-c*o,e[11]=m*a-l*o,b=n.view,y=n.view,w=Math.sin(x=n.viewRotation[0]),P=Math.cos(x),C=y[0],S=y[1],B=y[2],T=y[3],E=y[8],A=y[9],k=y[10],M=y[11],y!==b&&(b[4]=y[4],b[5]=y[5],b[6]=y[6],b[7]=y[7],b[12]=y[12],b[13]=y[13],b[14]=y[14],b[15]=y[15]),b[0]=C*P-E*w,b[1]=S*P-A*w,b[2]=B*P-k*w,b[3]=T*P-M*w,b[8]=C*w+E*P,b[9]=S*w+A*P,b[10]=B*w+k*P,b[11]=T*w+M*P,g(n.view,n.view,n.viewPos),n.renderer.view=n.view,n.renderer.projection=n.projection,n.brightnessTimer+=.005,n.brightnessTimer>2*Math.PI&&(n.brightnessTimer-=2*Math.PI);var F=Math.sin(n.brightnessTimer)/4+.75;n.renderer.brightness=F,n.colorTimer+=.001,n.colorTimer>1&&(n.colorTimer-=1),n.renderer.colorRotate=n.colorTimer,n.lightDirectionTimer+=.002,n.lightDirectionTimer>2*Math.PI&&(n.lightDirectionTimer-=2*Math.PI);var O=.25+Math.cos(n.lightDirectionTimer)/8,L=Math.sin(Math.acos(O)),_=Math.cos(n.lightDirectionTimer)*L,N=Math.sin(n.lightDirectionTimer)*L;n.renderer.lightDirection=((R=new d(3))[0]=_,R[1]=O,R[2]=N,R),n.renderer.renderStart(),n.renderer.setObjectShader(),n.renderer.renderLittleSphere(),n.renderer.renderSphereCubes(),n.renderer.renderDigits(U),n.renderer.setBackgroundShader(),n.renderer.renderBeckgound(),n.renderer.renderEnd(),requestAnimationFrame(n.gameLoop)}),A(this,"moveForward",!1),A(this,"moveBackward",!1),A(this,"moveLeft",!1),A(this,"moveRight",!1),A(this,"moveUp",!1),A(this,"moveDown",!1),A(this,"moveFast",!1),A(this,"windowResized",!1),this.renderer=e,this.htmlCanvas=r,this.dialogButton=i;for(var o=0;o<this.boxColliderBuffer.length;o++)this.boxColliderBuffer[o]=new T(0,0,0,0,0,0);this.view=m(),this.viewPos=E(),this.viewPos[2]=-3,this.viewRotation=E(),this.projection=m(),this.zoomCamera(0),this.renderer.view=this.view,this.renderer.projection=this.projection;var a=localStorage.getItem("timeout");null!==a?this.timeout=Number.parseInt(a):this.timeout=Date.now()+6e5;var s=localStorage.getItem("moveSpeed");null!==s?this.moveSpeed=Number.parseFloat(s):this.moveSpeed=1;var u=localStorage.getItem("mouseSensitivity");null!==u?this.mouseSensitivity=Number.parseFloat(u):this.mouseSensitivity=1,this.gameLoop()}return e=[{key:"handleCameraCollision",value:function(){if(-25<this.viewPos[1]&&this.viewPos[1]<25&&198<this.viewPos[2]&&this.viewPos[2]<202){for(var e=T.create(this.viewPos,.5),t=0;t<this.boxColliderCount;t++){var r=this.boxColliderBuffer[t];if(r.hasCollision(e)){var i=r.handleCollision(e);this.viewPos[0]+=i[0],this.viewPos[1]+=i[1],this.viewPos[2]+=i[2];break}}return}if(-202<this.viewPos[0]&&this.viewPos[0]<202&&-202<this.viewPos[1]&&this.viewPos[1]<202&&298<this.viewPos[2]&&this.viewPos[2]<702){var n=T.create(this.viewPos,.5);if(T.create([0,0,500],20).hasCollision(n)){var o=this.viewPos[0]-0,a=this.viewPos[1]-0,u=this.viewPos[2]-500,c=Math.sqrt(o*o+a*a+u*u),l=21-c;if(l<=0)return;var h=[o/c,a/c,u/c];this.viewPos[0]+=h[0]*l,this.viewPos[1]+=h[1]*l,this.viewPos[2]+=h[2]*l;return}for(var f=0;f<s.sphere.vertixCount;f++){var v=T.create([-200*s.sphere.vertices[8*f],-200*s.sphere.vertices[8*f+1],-200*s.sphere.vertices[8*f+2]+500],.5);if(v.hasCollision(n)){var d=v.handleCollision(n);this.viewPos[0]+=d[0],this.viewPos[1]+=d[1],this.viewPos[2]+=d[2];break}}return}}},{key:"createDigitModels",value:function(){var e=this,t=function(e,t){return p(e),g(e,e,[t,0,-200]),e},r=function(t){g(t,t,[0,22,0]),b(t,t,[10,1,1]);var r=e.boxColliderBuffer[e.boxColliderCount++];return r.ax=-t[12]-10,r.bx=-t[12]+10,r.ay=-t[13]-1,r.by=-t[13]+1,r.az=-t[14]-1,r.bz=-t[14]+1,t},i=function(t){b(t,t,[10,1,1]);var r=e.boxColliderBuffer[e.boxColliderCount++];return r.ax=-t[12]-10,r.bx=-t[12]+10,r.ay=-t[13]-1,r.by=-t[13]+1,r.az=-t[14]-1,r.bz=-t[14]+1,t},n=function(t){g(t,t,[0,-22,0]),b(t,t,[10,1,1]);var r=e.boxColliderBuffer[e.boxColliderCount++];return r.ax=-t[12]-10,r.bx=-t[12]+10,r.ay=-t[13]-1,r.by=-t[13]+1,r.az=-t[14]-1,r.bz=-t[14]+1,t},o=function(t){g(t,t,[-11,11,0]),b(t,t,[1,10,1]);var r=e.boxColliderBuffer[e.boxColliderCount++];return r.ax=-t[12]-1,r.bx=-t[12]+1,r.ay=-t[13]-10,r.by=-t[13]+10,r.az=-t[14]-1,r.bz=-t[14]+1,t},a=function(t){g(t,t,[11,11,0]),b(t,t,[1,10,1]);var r=e.boxColliderBuffer[e.boxColliderCount++];return r.ax=-t[12]-1,r.bx=-t[12]+1,r.ay=-t[13]-10,r.by=-t[13]+10,r.az=-t[14]-1,r.bz=-t[14]+1,t},s=function(t){g(t,t,[-11,-11,0]),b(t,t,[1,10,1]);var r=e.boxColliderBuffer[e.boxColliderCount++];return r.ax=-t[12]-1,r.bx=-t[12]+1,r.ay=-t[13]-10,r.by=-t[13]+10,r.az=-t[14]-1,r.bz=-t[14]+1,t},u=function(t){g(t,t,[11,-11,0]),b(t,t,[1,10,1]);var r=e.boxColliderBuffer[e.boxColliderCount++];return r.ax=-t[12]-1,r.bx=-t[12]+1,r.ay=-t[13]-10,r.by=-t[13]+10,r.az=-t[14]-1,r.bz=-t[14]+1,t};this.boxColliderCount=0;var c=this.timeout-Date.now();if(c<0){var l=this.modelBuffer.slice(96),h=m();return l.set(r(t(h,0)),0),l.set(n(t(h,0)),16),l.set(o(t(h,0)),32),l.set(a(t(h,0)),48),l.set(s(t(h,0)),64),l.set(u(t(h,0)),80),this.dialogButton.setAttribute("timeout",""),l.buffer}var f=[],v=0;do{var d=c%10;switch(f.push(d),d){case 0:case 6:case 9:v+=6;break;case 1:v+=2;break;case 2:case 3:case 5:v+=5;break;case 4:v+=4;break;case 7:v+=3;break;case 8:v+=7}c=Math.floor(c/10)}while(c>0);for(var y=this.modelBuffer.slice(16*v),x=m(),w=(f.length-1)/2,P=-16,C=0;C<f.length;C++){var S=(w-C)*40;switch(f[C]){case 0:y.set(r(t(x,S)),P+=16),y.set(n(t(x,S)),P+=16),y.set(o(t(x,S)),P+=16),y.set(a(t(x,S)),P+=16),y.set(s(t(x,S)),P+=16),y.set(u(t(x,S)),P+=16);break;case 1:y.set(a(t(x,S)),P+=16),y.set(u(t(x,S)),P+=16);break;case 2:y.set(r(t(x,S)),P+=16),y.set(i(t(x,S)),P+=16),y.set(n(t(x,S)),P+=16),y.set(a(t(x,S)),P+=16),y.set(s(t(x,S)),P+=16);break;case 3:y.set(r(t(x,S)),P+=16),y.set(i(t(x,S)),P+=16),y.set(n(t(x,S)),P+=16),y.set(a(t(x,S)),P+=16),y.set(u(t(x,S)),P+=16);break;case 4:y.set(i(t(x,S)),P+=16),y.set(o(t(x,S)),P+=16),y.set(a(t(x,S)),P+=16),y.set(u(t(x,S)),P+=16);break;case 5:y.set(r(t(x,S)),P+=16),y.set(i(t(x,S)),P+=16),y.set(n(t(x,S)),P+=16),y.set(o(t(x,S)),P+=16),y.set(u(t(x,S)),P+=16);break;case 6:y.set(r(t(x,S)),P+=16),y.set(i(t(x,S)),P+=16),y.set(n(t(x,S)),P+=16),y.set(o(t(x,S)),P+=16),y.set(s(t(x,S)),P+=16),y.set(u(t(x,S)),P+=16);break;case 7:y.set(r(t(x,S)),P+=16),y.set(a(t(x,S)),P+=16),y.set(u(t(x,S)),P+=16);break;case 8:y.set(r(t(x,S)),P+=16),y.set(i(t(x,S)),P+=16),y.set(n(t(x,S)),P+=16),y.set(o(t(x,S)),P+=16),y.set(a(t(x,S)),P+=16),y.set(s(t(x,S)),P+=16),y.set(u(t(x,S)),P+=16);break;case 9:y.set(r(t(x,S)),P+=16),y.set(i(t(x,S)),P+=16),y.set(n(t(x,S)),P+=16),y.set(o(t(x,S)),P+=16),y.set(a(t(x,S)),P+=16),y.set(u(t(x,S)),P+=16)}}return y.buffer}},{key:"setWindowResized",value:function(){this.windowResized=!0}},{key:"rotateCamera",value:function(e,t){var r=.001*this.mouseSensitivity;this.viewRotation[0]+=r*e,this.viewRotation[0]<0?this.viewRotation[0]+=2*Math.PI:this.viewRotation[0]>2*Math.PI&&(this.viewRotation[0]-=2*Math.PI),this.viewRotation[1]+=r*t,this.viewRotation[1]<-Math.PI/2?this.viewRotation[1]=-Math.PI/2:this.viewRotation[1]>Math.PI/2&&(this.viewRotation[1]=Math.PI/2)}},{key:"zoomCamera",value:function(e){this.projectionFieldOfView+=.01*e,this.projectionFieldOfView<.3?this.projectionFieldOfView=.3:this.projectionFieldOfView>1.6&&(this.projectionFieldOfView=1.6),y(this.projection,this.projectionFieldOfView,this.htmlCanvas.width/this.htmlCanvas.height,.1,500)}}],function(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t.prototype,e),t}();A(k,"SPEED_MULTIPLIER",5);function M(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var R=function(){var e;function t(e,r){var i=this;!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,t),M(this,"logic",void 0),M(this,"htmlCanvas",void 0),M(this,"onMouseMove",function(e){document.pointerLockElement===i.htmlCanvas&&i.logic.rotateCamera(e.movementX,e.movementY)}),M(this,"onMouseWheel",function(e){i.logic.zoomCamera(e.deltaY)}),M(this,"ctrlPressed",void 0),M(this,"altPressed",void 0),M(this,"onKeyPressed",function(e){i.onKeyTriggered(!0,e)}),M(this,"onKeyReleased",function(e){i.onKeyTriggered(!1,e)}),this.logic=e,this.htmlCanvas=r,this.htmlCanvas.onresize=function(){return i.logic.setWindowResized()},this.htmlCanvas.onclick=function(){return i.htmlCanvas.requestPointerLock()},this.htmlCanvas.onmousemove=this.onMouseMove,document.onwheel=this.onMouseWheel,document.onkeydown=this.onKeyPressed,document.onkeyup=this.onKeyReleased}return e=[{key:"onKeyTriggered",value:function(e,t){switch(t.code){case"KeyW":this.logic.moveForward=e,t.preventDefault();break;case"KeyS":this.logic.moveBackward=e,t.preventDefault();break;case"KeyA":this.logic.moveLeft=e,t.preventDefault();break;case"KeyD":this.logic.moveRight=e,t.preventDefault();break;case"Space":this.logic.moveUp=e,t.preventDefault();break;case"ShiftLeft":this.logic.moveDown=e,t.preventDefault();break;case"ControlLeft":this.logic.moveFast=(this.ctrlPressed=e)||this.altPressed,t.preventDefault();break;case"AltLeft":this.logic.moveFast=(this.altPressed=e)||this.ctrlPressed,t.preventDefault()}}}],function(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(t.prototype,e),t}();function U(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var z=function e(t,r,i){var n=this;!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,e),U(this,"logic",void 0),U(this,"dialogButton",void 0),U(this,"htmlDialog",void 0),U(this,"timerInput",void 0),U(this,"timerButton",void 0),U(this,"moveSpeedInput",void 0),U(this,"moveSpeedLabel",void 0),U(this,"mouseSensitivtyInput",void 0),U(this,"mouseSensitivtyLabel",void 0),U(this,"onDialogButton",function(e){var t=n.logic.timeout-Date.now();n.timerInput.value=t>0?t.toString():"0",n.htmlDialog.showModal()}),U(this,"onDialogClicked",function(e){var t=n.htmlDialog.getBoundingClientRect(),r=t.top+t.height,i=t.left+t.width;(e.clientY<t.top||e.clientY>r||e.clientX<t.left||e.clientX>i)&&n.htmlDialog.close()}),U(this,"onTimerChange",function(e){/^\d+$/.test(n.timerInput.value)?n.timerInput.style.borderColor="#888":n.timerInput.style.borderColor="#F22"}),U(this,"onTimerButtonClicked",function(e){/^\d+$/.test(n.timerInput.value)&&(n.timerInput.style.borderColor="#2F2",n.dialogButton.removeAttribute("timeout"),n.logic.timeout=Date.now()+Number.parseInt(n.timerInput.value),localStorage.setItem("timeout",n.logic.timeout.toString()))}),U(this,"onMoveSpeedChanged",function(e){var t=e.target.value;n.moveSpeedLabel.textContent=t,n.logic.moveSpeed=Number.parseFloat(t),localStorage.setItem("moveSpeed",t)}),U(this,"onMouseSensitivtyChanged",function(e){var t=e.target.value;n.mouseSensitivtyLabel.textContent=t,n.logic.mouseSensitivity=Number.parseFloat(t),localStorage.setItem("mouseSensitivity",t)}),this.logic=t,this.dialogButton=r,this.htmlDialog=i,this.dialogButton.onclick=this.onDialogButton,this.htmlDialog.onclick=this.onDialogClicked;var o=this.htmlDialog.children[0].children[0],a=o.children[0];this.timerInput=a.children[1],this.timerInput.onchange=this.onTimerChange,this.timerButton=a.children[2],this.timerButton.onclick=this.onTimerButtonClicked;var s=o.children[1];this.moveSpeedInput=s.children[1],this.moveSpeedInput.oninput=this.onMoveSpeedChanged,this.moveSpeedLabel=s.children[2];var u=o.children[2];this.mouseSensitivtyInput=u.children[1],this.mouseSensitivtyInput.oninput=this.onMouseSensitivtyChanged,this.mouseSensitivtyLabel=u.children[2],this.moveSpeedInput.value=t.moveSpeed.toString(),this.moveSpeedLabel.textContent=this.moveSpeedInput.value,this.mouseSensitivtyInput.value=t.mouseSensitivity.toString(),this.mouseSensitivtyLabel.textContent=this.mouseSensitivtyInput.value};function I(e,t,r,i,n,o,a){try{var s=e[o](a),u=s.value}catch(e){r(e);return}s.done?t(u):Promise.resolve(u).then(i,n)}function D(){var e;return e=function(){var e,t,r,i;return function(e,t){var r,i,n,o,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw TypeError("Generator is already executing.");for(;a;)try{if(r=1,i&&(n=2&o[0]?i.return:o[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,o[1])).done)return n;switch(i=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(n=(n=a.trys).length>0&&n[n.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){a.label=o[1];break}if(6===o[0]&&a.label<n[1]){a.label=n[1],n=o;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(o);break}n[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}(this,function(n){switch(n.label){case 0:return e=document.querySelector("canvas"),t=document.querySelector("svg"),r=document.querySelector("dialog"),[4,C.create(e)];case 1:return new R(i=new k(n.sent(),e,t),e),new z(i,t,r),[2]}})},(D=function(){var t=this,r=arguments;return new Promise(function(i,n){var o=e.apply(t,r);function a(e){I(o,i,n,a,s,"next",e)}function s(e){I(o,i,n,a,s,"throw",e)}a(void 0)})}).apply(this,arguments)}!function(){D.apply(this,arguments)}()})();